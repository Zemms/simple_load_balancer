# Сервис-балансировщик видео-трафика

## Описание

Асинхронный сервис на FastAPI для балансировки запросов на видео-контент между origin-серверами и CDN. Построен с учетом принципов "чистой" архитектуры, отказоустойчивости и высокой производительности.

## Стек

-   Python 3.11+
-   FastAPI
-   PostgreSQL
-   Redis
-   Poetry для управления зависимостями
-   Docker

## Запуск проекта

1.  **Установите Docker и Docker Compose.**

2.  **Соберите и запустите контейнеры:**
    ```
    docker-compose up --build
    ```
    Сервис будет доступен по адресу `http://localhost:8000`.

## Локальная разработка

1.  **Установите Poetry.**

2.  **Установите зависимости:**
    ```
    poetry install
    ```

3.  **Запустите dev-сервер:**
    ```
    poetry run uvicorn src.main:app --reload
    ```

## API

### Балансировка

-   **GET /**
    -   **Query-параметр:** `video` (обязательный) - полный URL видеофайла на origin-сервере.
    -   **Пример:** `http://localhost:8000/?video=http://s1.origin-cluster/video/1488/content.m3u8`
    -   **Ответ:** `HTTP 307 Temporary Redirect` на CDN или origin URL.

### Управление настройками

-   **GET /api/v1/settings**
    -   Получить текущие настройки.

-   **PUT /api/v1/settings**
    -   Обновить настройки.
    -   **Body (JSON):**
        ```
        {
          "cdn_host": "new.cdn.com",
          "ratio": 20
        }
        ```

## Нагрузочное тестирование

Для тестирования используется `k6`.

1.  **Установите k6.**

2.  **Запустите тест из корневой директории проекта:**
    ```
    k6 run scripts/load_test.js
    ```
